# Use Alpine Linux for small image size
FROM alpine:3.19

# Install g++ and make
RUN apk add --no-cache g++ make

# Set working directory
WORKDIR /app

# Copy source files
COPY broker/broker.cpp ./broker/
COPY common/*.cpp common/*.h ./common/

# Compile broker
RUN g++ -std=c++11 -O2 -o broker_exe broker/broker.cpp

# Expose ports
EXPOSE 9100 9200 8081

# Run broker
CMD ["./broker_exe", "9100", "9200", "8081"]
